# 需求与设计概要

## 1. 目标

- 提供一个可运行的 Panda3D 赛车 Demo。
- 车辆逻辑采用“数据 + 系统 + 业务编排”分层，便于扩展。
- 支持基础驾驶体验：加速、刹车、转向、相机跟随、速度/RPM/档位显示。
- 提供可复用的赛道基底地形生成工具。

## 2. 核心需求

### 功能需求

- 车辆状态更新：位置、朝向、速度、转向角、发动机转速。
- 车辆子系统：Physics / Suspension / Pose / Wheel / Tire / Transmission。
- 游戏主循环：输入采集、系统更新、渲染更新、UI 更新。
- 地形生成：支持噪声底图、平滑、赛道走廊刷平、导出多格式。

### 工程需求

- 代码分层清晰，参数可配置。
- 输出可观测信息（如地形生成阶段耗时、JSON 报告）。
- 关键逻辑可通过示例脚本快速验证。

## 3. 设计概要

### 分层结构

- 应用层：`main.py`
- 业务层：`src/business/vehicle_entity.py`、`src/business/game_world.py`
- 系统层：`src/systems/*.py`
- 数据层：`src/data/*.py`

### 数据流（简化）

- 输入 -> VehicleEntity -> 各系统顺序更新 -> 状态 -> 可视化/UI。

### 地形生成流

- fBm 噪声 -> 高斯平滑 -> 可选赛道走廊刷平 -> 导出 `pgm/npy/json`。

## 4. 已知限制（简述）

- `relief_strength` 当前效果有限（参数影响会被归一化抵消）。
- 无 `panda3d` 环境时，图形相关导入会影响部分示例运行。

## 5. 迭代方向

- 修正地形起伏压缩参数行为。
- 完善无图形环境下的纯逻辑测试入口。
- 继续增强车辆动力学真实性与稳定性。
